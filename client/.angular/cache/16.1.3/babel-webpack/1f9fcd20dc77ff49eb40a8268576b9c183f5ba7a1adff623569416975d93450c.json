{"ast":null,"code":"// Decorators and Lifehooks\nimport { TemplateRef } from '@angular/core';\n// Services\nimport { CommentService } from '../../services/comment.service';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/comment.service\";\nimport * as i2 from \"ngx-bootstrap/modal\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"../../pipes/comment-time.pipe\";\nfunction CommentComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"div\", 11)(2, \"a\", 12);\n    i0.ɵɵelement(3, \"img\", 13);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 14)(5, \"h6\", 15)(6, \"a\", 12);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"commentTime\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"div\", 16)(11, \"p\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function CommentComponent_div_8_Template_button_click_13_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const c_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext();\n      const _r1 = i0.ɵɵreference(14);\n      return i0.ɵɵresetView(ctx_r6.openFormModal(_r1, c_r5._id));\n    });\n    i0.ɵɵtext(14, \"Edit Comment \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function CommentComponent_div_8_Template_button_click_15_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const c_r5 = restoredCtx.$implicit;\n      const ctx_r8 = i0.ɵɵnextContext();\n      const _r3 = i0.ɵɵreference(16);\n      return i0.ɵɵresetView(ctx_r8.openRemoveModal(_r3, c_r5._id));\n    });\n    i0.ɵɵtext(16, \"Delete Comment \");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const c_r5 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"routerLink\", \"/user/profile/\", c_r5.user.username, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"src\", c_r5.user.avatar, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate1(\"routerLink\", \"/user/profile/\", c_r5.user.username, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"by \", c_r5.user.username, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(9, 8, c_r5.creationDate), \" ago \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(c_r5.content);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"hidden\", !ctx_r0.isAdmin && c_r5.user._id !== ctx_r0.userId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"hidden\", !ctx_r0.isAdmin && c_r5.user._id !== ctx_r0.userId);\n  }\n}\nfunction CommentComponent_ng_template_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"h4\", 20);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function CommentComponent_ng_template_13_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.commentModalRef.hide());\n    });\n    i0.ɵɵelementStart(4, \"span\", 22);\n    i0.ɵɵtext(5, \"\\u00D7\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(6, \"div\", 23)(7, \"form\", 24, 25);\n    i0.ɵɵlistener(\"ngSubmit\", function CommentComponent_ng_template_13_Template_form_ngSubmit_7_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.onSubmit());\n    });\n    i0.ɵɵelementStart(9, \"div\", 26);\n    i0.ɵɵelement(10, \"textarea\", 27);\n    i0.ɵɵelementStart(11, \"div\", 28)(12, \"button\", 29);\n    i0.ɵɵlistener(\"click\", function CommentComponent_ng_template_13_Template_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.commentModalRef.hide());\n    });\n    i0.ɵɵtext(13, \"Submit\");\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r2.action, \" Comment\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"formGroup\", ctx_r2.commentForm);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"disabled\", ctx_r2.commentForm.invalid);\n  }\n}\nfunction CommentComponent_ng_template_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 30)(1, \"p\");\n    i0.ɵɵtext(2, \"Do you really want to delete your comment?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function CommentComponent_ng_template_15_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.removeComment());\n    });\n    i0.ɵɵtext(4, \"Yes\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function CommentComponent_ng_template_15_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.removeModalRef.hide());\n    });\n    i0.ɵɵtext(6, \"No\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let CommentComponent = /*#__PURE__*/(() => {\n  class CommentComponent {\n    constructor(commentService, modalService) {\n      this.commentService = commentService;\n      this.modalService = modalService;\n      this.comments = [];\n    }\n    ngOnInit() {\n      this.commentForm = new FormGroup({\n        'content': new FormControl('', Validators.required)\n      });\n      this.commentService.getComments(this.bookId, this.comments.length.toString()).subscribe(res => {\n        this.comments = res.data;\n      });\n    }\n    openFormModal(template, id) {\n      if (id) {\n        let content = '';\n        this.isFromEdit = true;\n        this.lastEditId = id;\n        for (const c of this.comments) {\n          if (c._id === id) {\n            content = c.content;\n            break;\n          }\n        }\n        this.action = 'Edit';\n        this.commentForm.patchValue({\n          content: content\n        });\n      } else {\n        this.action = 'Create';\n        this.isFromEdit = false;\n        this.commentForm.patchValue({\n          content: ''\n        });\n      }\n      this.commentModalRef = this.modalService.show(template, {\n        class: 'myModal'\n      });\n    }\n    openRemoveModal(template, id) {\n      this.lastDeleteId = id;\n      this.removeModalRef = this.modalService.show(template, {\n        class: 'myModal modal-sm'\n      });\n    }\n    onSubmit() {\n      if (this.isFromEdit) {\n        this.modifyComment();\n      } else {\n        this.createComment();\n      }\n    }\n    loadMoreComments() {\n      this.commentService.getComments(this.bookId, this.comments.length.toString()).subscribe(res => {\n        if (res.data.length !== 0) {\n          this.comments.splice(this.comments.length, 0, ...res.data);\n        }\n      });\n    }\n    createComment() {\n      this.commentService.addComment(this.bookId, this.commentForm.value).subscribe(res => {\n        this.comments.unshift(res.data);\n      });\n      this.commentForm.reset();\n    }\n    modifyComment() {\n      const editedContent = this.commentForm.value.content;\n      this.commentService.editComment(this.lastEditId, this.commentForm.value).subscribe(() => {\n        for (const c of this.comments) {\n          if (c._id === this.lastEditId) {\n            c.content = editedContent;\n            break;\n          }\n        }\n      });\n      this.commentForm.reset();\n    }\n    removeComment() {\n      this.removeModalRef.hide();\n      const delId = this.lastDeleteId;\n      this.commentService.deleteComment(this.lastDeleteId).subscribe(() => {\n        this.comments = this.comments.filter(c => c._id !== delId);\n      });\n    }\n  }\n  CommentComponent.ɵfac = function CommentComponent_Factory(t) {\n    return new (t || CommentComponent)(i0.ɵɵdirectiveInject(i1.CommentService), i0.ɵɵdirectiveInject(i2.BsModalService));\n  };\n  CommentComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CommentComponent,\n    selectors: [[\"app-comment\"]],\n    inputs: {\n      bookId: \"bookId\",\n      isLogged: \"isLogged\",\n      isAdmin: \"isAdmin\",\n      userId: \"userId\"\n    },\n    decls: 17,\n    vars: 2,\n    consts: [[1, \"row\"], [1, \"comments\", \"col-md-9\"], [1, \"mb-2\"], [1, \"row\", \"pt-2\"], [1, \"col-12\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 3, \"hidden\", \"click\"], [\"class\", \"comment mb-2 row\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [\"commentFormTemplate\", \"\"], [\"remove\", \"\"], [1, \"comment\", \"mb-2\", \"row\"], [1, \"comment-avatar\", \"col-md-1\", \"col-sm-2\", \"text-center\", \"pr-1\"], [3, \"routerLink\"], [\"alt\", \"avatar\", 1, \"mx-auto\", \"rounded-circle\", \"img-fluid\", 3, \"src\"], [1, \"comment-content\", \"col-md-11\", \"col-sm-10\"], [1, \"small\", \"comment-meta\"], [1, \"comment-body\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", \"btn-sm\", 3, \"hidden\", \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", \"btn-sm\", 3, \"hidden\", \"click\"], [1, \"modal-header\"], [1, \"modal-title\", \"pull-left\"], [\"type\", \"button\", \"aria-label\", \"Close\", 1, \"close\", \"pull-right\", 3, \"click\"], [\"aria-hidden\", \"true\"], [1, \"modal-body\"], [3, \"formGroup\", \"ngSubmit\"], [\"formDir\", \"ngForm\"], [1, \"form-group\"], [\"name\", \"content\", \"cols\", \"30\", \"rows\", \"10\", \"formControlName\", \"content\", 1, \"form-control\"], [1, \"test\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\", \"click\"], [1, \"modal-body\", \"text-center\"], [\"type\", \"button\", 1, \"btn\", \"btn-default\", 3, \"click\"]],\n    template: function CommentComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r17 = i0.ɵɵgetCurrentView();\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h3\", 2);\n        i0.ɵɵtext(3, \"Comments\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 3)(5, \"div\", 4)(6, \"button\", 5);\n        i0.ɵɵlistener(\"click\", function CommentComponent_Template_button_click_6_listener() {\n          i0.ɵɵrestoreView(_r17);\n          const _r1 = i0.ɵɵreference(14);\n          return i0.ɵɵresetView(ctx.openFormModal(_r1));\n        });\n        i0.ɵɵtext(7, \"Add Comment \");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(8, CommentComponent_div_8_Template, 17, 10, \"div\", 6);\n        i0.ɵɵelementStart(9, \"div\", 3)(10, \"div\", 4)(11, \"button\", 7);\n        i0.ɵɵlistener(\"click\", function CommentComponent_Template_button_click_11_listener() {\n          return ctx.loadMoreComments();\n        });\n        i0.ɵɵtext(12, \"Load More...\");\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵtemplate(13, CommentComponent_ng_template_13_Template, 14, 3, \"ng-template\", null, 8, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(15, CommentComponent_ng_template_15_Template, 7, 0, \"ng-template\", null, 9, i0.ɵɵtemplateRefExtractor);\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"hidden\", !ctx.isLogged);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.comments);\n      }\n    },\n    dependencies: [i3.NgForOf, i4.RouterLink, i5.ɵNgNoValidate, i5.DefaultValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.FormGroupDirective, i5.FormControlName, i6.CommentTimePipe],\n    styles: [\".test[_ngcontent-%COMP%]{margin-top:10px}.comment[_ngcontent-%COMP%]{padding:20px;background-color:#313532;border-radius:10px}.col-12[_ngcontent-%COMP%]{margin-bottom:10px}.col-md-9[_ngcontent-%COMP%]{text-align:center;margin:0 auto}.mb-2[_ngcontent-%COMP%]{margin-bottom:10px}.comment-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{float:left;margin-left:10px}.comment-meta[_ngcontent-%COMP%]{text-align:left}.comment-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:justify}\"]\n  });\n  return CommentComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}